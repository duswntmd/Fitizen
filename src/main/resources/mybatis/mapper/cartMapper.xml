<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.sku.fitizen.mapper.CartMapper">

    <!-- 장바구니에 항목 추가 -->
    <insert id="insertCartItem" parameterType="com.sku.fitizen.domain.CartItem" >
        INSERT INTO cart_item (id, product_id, qty, price, user_id, product_name, product_price)
        VALUES (cart_item_seq.NEXTVAL, #{product_id}, #{qty}, #{price}, #{user_id}, #{product_name}, #{product_price})
    </insert>

    <select id="selectCartItemsByUserId" parameterType="string" resultMap="cartItemResultMap">
        SELECT ci.*, p.prname, p.prprice, p.prid
        FROM cart_item ci
                 JOIN product p ON ci.product_id = p.prid
        WHERE ci.user_id = #{user_id}
    </select>

    <!-- 장바구니 항목 삭제 -->
    <delete id="deleteCartItemsByUserId" parameterType="string">
        DELETE FROM cart_item WHERE user_id = #{user_id}
    </delete>

    <resultMap id="cartItemResultMap" type="com.sku.fitizen.domain.CartItem">
        <result property="id" column="id"/>
        <result property="qty" column="qty"/>
        <result property="price" column="price"/>
        <association property="product" javaType="com.sku.fitizen.domain.Product">
            <result property="prid" column="prid"/>
            <result property="prname" column="prname"/>
            <result property="prprice" column="prprice"/>
        </association>
    </resultMap>

</mapper>
