<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>WebSocket Test Page</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f7f7f7;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
            justify-content: center;
        }
        #chatContainer {
            width: 360px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            height: 500px;
            overflow: hidden;
        }
        #chatBoxArea {
            width: 100%;
            height: 100%;
            border: none;
            padding: 10px;
            box-sizing: border-box;
            overflow-y: auto;
            background-color: #f0f0f0;
            font-size: 14px;
        }
        #inputContainer {
            display: flex;
            align-items: center;
            border-top: 1px solid #ddd;
            padding: 10px;
            background-color: white;
        }
        #inputMsgBox {
            flex: 1;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        #sendButton, #disconnectButton {
            background-color: #0095f6;
            color: white;
            border: none;
            padding: 10px 20px;
            margin-left: 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        #disconnectButton {
            background-color: #f44336;
        }
        #sendButton:hover, #disconnectButton:hover {
            opacity: 0.8;
        }
        #disconnectButton:hover {
            background-color: #d32f2f;
        }
    </style>
</head>
<body>
<div id="chatContainer">
    <textarea id="chatBoxArea" readonly="readonly"></textarea>
    <div id="inputContainer">
        <input id="inputMsgBox" type="text" placeholder="Type a message...">
        <input id="sendButton" type="button" value="Send" onclick="sendButton_onclick()">
        <input id="disconnectButton" type="button" value="Disconnect" onclick="disconnectButton_onclick()">
    </div>
</div>
<script type="text/javascript">
    var userid = '[[${userid}]]';
    var g_webSocket = null;

    window.onload = function() {
        var roomId = '[[${roomId}]]';
        var host = "localhost";
        g_webSocket = new WebSocket("ws://" + host + "/chat"+ "&roomId=" + roomId);

        g_webSocket.onopen = function(message) {
            addLineToChatBox("챌린지 참여 채팅방입니다.");
        };

        g_webSocket.onmessage = function(message) {
            addLineToChatBox(message.data);
        };

        g_webSocket.onclose = function(message) {
            addLineToChatBox("Server is disconnected.");
        };

        g_webSocket.onerror = function(message) {
            addLineToChatBox("Error!");
        };
    }

    function addLineToChatBox(_line) {
        if (_line == null) {
            _line = "";
        }
        var chatBoxArea = document.getElementById("chatBoxArea");
        chatBoxArea.value += _line + "\n";
        chatBoxArea.scrollTop = chatBoxArea.scrollHeight;
    }

    function sendButton_onclick() {
        var inputMsgBox = document.getElementById("inputMsgBox");
        if (inputMsgBox == null || inputMsgBox.value == null || inputMsgBox.value.length == 0) {
            return false;
        }
        var chatBoxArea = document.getElementById("chatBoxArea");
        if (g_webSocket == null || g_webSocket.readyState == 3) {
            chatBoxArea.value += "Server is disconnected.\n";
            return false;
        }
        g_webSocket.send('[' + userid + '] ' + inputMsgBox.value);
        inputMsgBox.value = "";
        inputMsgBox.focus();
        return true;
    }

    function disconnectButton_onclick() {
        if (g_webSocket != null) {
            g_webSocket.close();
        }
    }

    function inputMsgBox_onkeypress(event) {
        if (event == null) {
            return false;
        }
        var keyCode = event.keyCode || event.which;
        if (keyCode == 13) {
            sendButton_onclick(event);
        }
    }

    document.getElementById('inputMsgBox').addEventListener('keypress', inputMsgBox_onkeypress);
</script>
</body>
</html>
